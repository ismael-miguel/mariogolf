<!DOCTYPE html>
<html>
	<head>
		<title>MarioGolf interpreter and debugger</title>
	</head>
	<body>
		<font face="sans-serif">
			<noscript>
				<div><font color="red"><b>! THIS PAGE REQUIRES JAVASCRIPT !</b></font></div>
			</noscript>
			<table width="850" cellspacing="0" cellpadding="0" border="0">
				<tr>
					<td width="50%" valign="top">
						<form id="code-form" action="javascript:void(0);" onsubmit="runcode();return false;">
							<h4>Code</h4><br>
							<textarea id="mariocode" placeholder="M|O" cols="50" rows="15"></textarea><br>
							<label>Input:</label>
							<input type="text" id="input" size="44" style="width:250px;"/>
							<input type="submit" id="run" value="Run code"/>
						</form>
					</td>
					<td width="30">&nbsp;</td>
					<td valign="top" width="395">
						<font size="2">
							<h4>Debug</h4>
							<table cellspacing="0" cellpadding="0" border="0" width="100%">
								<tr>
									<td>
										<h4>Code<span id="status"></span></h4>
									</td>
								</tr>
								<tr>
									<td>
										<table border="0" id="code-debug">
											<tr>
												<td><b>Init</b><br><span>M</span></td>
												<td><b>Body</b><br><span>&nbsp;</span></td>
												<td><b>Final</b><br><span>O</span></td>
											</tr>
										</table>
									</td>
								</tr>
								<tr><td><font size="1">&nbsp;</font></td></tr>
								<tr>
									<td>
										<h4>Registers</h4>
									</td>
								</tr>
								<tr>
									<td width="100%">
										<table border="0" height="100" id="registers">
											<tr><th>R</th><td>0</td></tr>
											<tr><th>I</th><td>0</td></tr>
											<tr><th>P</th><td>0</td></tr>
											<tr><th>L</th><td>0</td></tr>
											<tr><th>Z</th><td>0</td></tr>
										</table>
									</td>
								</tr>
								<tr><td><font size="1">&nbsp;</font></td></tr>
								<tr>
									<td>
										<h4>Variables</h4>
									</td>
								</tr>
								<tr>
									<td width="100%">
										<div style="height:100px;max-height:100px;overflow:auto;">
											<table border="0" height="100" id="vars">
												<tr><th>a</th><td>0</td></tr>
												<tr><th>b</th><td>0</td></tr>
												<tr><th>c</th><td>0</td></tr>
												<tr><th>d</th><td>0</td></tr>
												<tr><th>e</th><td>0</td></tr>
												<tr><th>f</th><td>0</td></tr>
												<tr><th>g</th><td>0</td></tr>
												<tr><th>h</th><td>0</td></tr>
												<tr><th>i</th><td>0</td></tr>
												<tr><th>j</th><td>0</td></tr>
												<tr><th>k</th><td>0</td></tr>
												<tr><th>l</th><td>0</td></tr>
												<tr><th>m</th><td>0</td></tr>
												<tr><th>n</th><td>0</td></tr>
												<tr><th>o</th><td>0</td></tr>
												<tr><th>p</th><td>0</td></tr>
												<tr><th>q</th><td>0</td></tr>
												<tr><th>r</th><td>0</td></tr>
												<tr><th>s</th><td>0</td></tr>
												<tr><th>t</th><td>0</td></tr>
												<tr><th>u</th><td>0</td></tr>
												<tr><th>v</th><td>0</td></tr>
												<tr><th>w</th><td>0</td></tr>
												<tr><th>x</th><td>0</td></tr>
												<tr><th>y</th><td>0</td></tr>
												<tr><th>z</th><td>0</td></tr>
											</table>
										</div>
									</td>
								</tr>
								<tr><td><font size="1">&nbsp;</font></td></tr>
								<tr>
									<td>
										<h4>Output</h4>
									</td>
								</tr>
								<tr>
									<td>
										<pre id="output-pre"></pre>
									</td>
								</tr>
							</table>
						</font>
					<td>
				</tr>
			</table>
		</font>
		<script src="https://raw.githubusercontent.com/ismael-miguel/mariogolf/master/js/mariogolf.js" language="javascript"></script>
		<script>
			//<!--
				function runcode(){
					try
					{
						var timeStart = new Date();
						
						var mario = new MarioGolf(document.getElementById('mariocode').value); // initiate mario, passing code
						//example of the setOutputHandler method
						mario.setOutputHandler(function(output){
							document.getElementById('output-pre').innerHTML = output; 
						});
						mario.run(document.getElementById('input').value); //run with input
						var memory = mario.getMemory(); //needed to debug
						
						document.getElementById('status').innerHTML = '&nbsp;<font color="green"> - Completed - '+ ( (new Date()) - timeStart  ) +' ms</font>';
						
						for(var i = 0, spans = document.getElementById('code-debug').getElementsByTagName('span'); i < spans.length; i++)
						{
							spans[i].innerText = memory.code[i+1] || '';
						}
						spans=null;
						
						for(var i = 0, tds = document.getElementById('vars').getElementsByTagName('td'); i < tds.length; i++)
						{
							tds[i].innerText = memory.vars[ String.fromCharCode(97+i) ];
						}
						
						for(var i = 0, tds = document.getElementById('vars').getElementsByTagName('td'); i < tds.length; i++)
						{
							tds[i].innerText = memory.vars[ String.fromCharCode(97+i) ];
						}
						
						var registers = document.getElementById('registers').getElementsByTagName('td');
						
						registers[0].innerHTML=memory.registers.R;
						registers[1].innerHTML=memory.registers.I;
						registers[2].innerHTML=memory.registers.P;
						registers[3].innerHTML=memory.registers.L;
						registers[4].innerHTML=memory.registers.Z;
						
						memory=registers=tds=null;
					}
					catch(e)
					{
						document.getElementById('status').innerHTML = '&nbsp;<font color="red"> - Error - '+e.message+'</font>';
					}
				};
				
				if( ~location.hash.indexOf('c:'))
				{
					document.getElementById('mariocode').value=location.hash.replace('#c:','');
					location.hash='';
				}
			//-->
		</script>
	</body>
</html>
