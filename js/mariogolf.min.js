!function(e,r){e.MarioGolf=function(t){var s=[];if(!t||!(t=t.match(/(?:^|[\r\n])([MLPBTYK]+)\|(?:(.*)\|)?([OQ|\-1RNM])(?:$|[\r\n])/)))throw new SyntaxError("Expecting identifier, got "+(t?"invalid program":"0-length code")+".","code",0);if(t[2]!=r&&(s[0]=t[2].match(/\{(?=([^"]*"[^"]*")*[^"]*$)/g)||[]).length!=(s[1]=t[2].match(/\}(?=([^"]*"[^"]*")*[^"]*$)/g)||[]).length)throw new SyntaxError('Missing "'+(s[0]<s[1]?"{":"}")+'" before the last identifier.',"code",0);var a={code:t,"return":"",input:"",stack:[],registers:{R:0,I:0,P:0,L:0,Z:0},vars:{},output:""},c=function(e){return e.replace(/[a-zA-Z]/g,function(e){return String.fromCharCode(("Z">=e?90:122)>=(e=e.charCodeAt(0)+13)?e:e-26)})},n=function(e){for(var r,t,s=e.length;s;r=Math.floor(Math.random()*s),t=e[--s],e[s]=e[r],e[r]=t);return e},i=function(e){var r=e.charAt(0),t=e.charAt(1);switch(r){case"'":return t;case'"':if(~e.indexOf('"',1))return e.substring(1,e.indexOf('"',1));throw new SyntaxError('Missing " before the end of the code',"code",0);case"|":if(/[a-zRIPLZ]/.test(t)&&(a.vars[t]||t in a.registers))return/^[a-z]$/.test(t)?a.vars[t]:a.registers[t];throw new ReferenceError('Undefined register "'+t+'"',"code",0);case"{":return o(e);default:return/[a-z\d]/.test(r)?e.match(/(^[a-z\d]+)/)[1]||0:void 0}},o=function(e){for(var r,t,s=0,c=e.length;c>s;s++)switch(a.registers.P++,r=e.charAt(s)){case"+":t=(a.registers.R/1||0)+i(e.slice(s+1));break;case"/":t=(a.registers.R/1||0)/i(e.slice(s+1))>>0;break;case"\\":t=(a.registers.R/1||0)%i(e.slice(s+1));break;case"-":t=a.registers.R-i(e.slice(s+1));break;case"^":t=Math.pow(a.registers.R,i(e.slice(s+1)));break;case"«":t=(a.registers.R/1||0)<<(32&i(e.slice(s+1)));break;case"»":t=(a.registers.R/1||0)>>(32&i(e.slice(s+1)));break;case"~":t=~(a.registers.R/1||0);break;case":":a.stack=[],a.registers.L=a.registers.R=0;break;case".":a.stack.shift(),a.registers.L=a.stack.length,a.registers.R=a.stack[0]||0;break;case",":a.registers.L=a.stack.push.apply(a.stack,a.input.split(""));break;case";":a.stack=a.input.split(""),a.registers.L=a.input.length;break;case"!":a.stack=a.stack.reverse(),a.registers.R=a.stack[0]||0;break;case"?":!a.stack.length||a.stack[0]&&"0"!=a.stack[0]||(a.stack.shift(),a.registers.R=a.stack[0]||0);break;case"<":var n=i(e.slice(s+1));if(n/1==n/1)t=a.stack[a.stack.length]=n>>0;else{t=n;for(var o=0,c=n.length;c>o;o++)a.stack[a.stack.length]=n.charAt(o)}a.registers.R=a.stack[0],a.registers.L=a.stack.length}},u=e.console.log;return{run:function(s){a={code:a.code,"return":"",input:s,stack:[],registers:{R:0,I:a.code.index,P:0,L:0,Z:0},vars:{},output:""};for(var i,k=!0,l=0,g=a.code[1].length;g>l;l++)switch(i=a.code[1].charAt(l)){case"M":a.stack=(s||"").split("");break;case"L":a.stack=s?(s+"").reverse().split(""):[];break;case"P":k=!1;break;case"B":if(a.stack=[],s)for(var h=0,f=s.length;f>h;h++)a.stack[h]=-s.charAt(h);break;case"T":a.stack=n(a.stack);break;case"Y":break;case"K":a.stack=a.code[0].replace(/^\s+/,"").split("");break;default:throw new ReferenceError('Unknown identifier "'+i+'"')}a.registers.L=a.stack.length,a.registers.R=a.stack[0]||0,a.registers.P=t[1].length+1,-1==a.code[3].indexOf("Q")&&a.code[2]&&(a["return"]=o(a.code[2])),0 in a.stack&&(a.stack[0]=a.registers.R);for(var i,l=0,g=a.code[3].length;g>l;l++)switch(i=a.code[3].charAt(l)){case"-":a["return"]=r;case"O":u.call(e.console,[a.output=a.stack.join("")]);break;case"Q":u.call(e.console,[a.output=a.code[0].replace(/^\s+/,"")]);break;case"|":a["return"]=a.stack;break;case"1":u.call(e.console,[a.output=c(a.stack.join(""))]);break;case"R":u.call(e.console,[a.output=a.stack.join("").split("").reverse().join("")]);break;case"N":u.call(e.console,[a.output=a.stack.join("").split("").join("\r\n")]),a["return"]=a.output.split("\r\n");break;case"M":if(a["return"]=[],a.stack.length)for(var h=0,f=a.stack.length;f>h;h++)a["return"][h]="string"==typeof a.stack[h]?a.stack[h]:String.fromCharCode(a.stack[h]);u.call(e.console,[a.output=a["return"].join("\r\n")]);break;default:throw new ReferenceError('Unknown identifier "'+i+'"')}return a["return"]},getStack:function(){return a.stack},getReturn:function(){return a["return"]},getVars:function(){return a.vars},getOutput:function(){return a.output},getMemory:function(){return a},setOutputHandler:function(r){return r instanceof e.Function?(u=r,!0):!1}}},e.MarioGolf.getVersion=function(){return{major:0,minor:3,revision:3,branch:"a",valueOf:function(){return this.major+"."+this.minor+"."+this.revision+"-"+this.branch},toString:function(){return this.valueOf()}}}}(Function("return this")());
